name: Workflow
on:
  push:
    branches:
      - main

jobs:
  tag:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: "✏️ Bump version and push tag"
      uses: anothrNick/github-tag-action@1.36.0
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        WITH_V: true
  changelog:
    - name: "✏️ Generate full changelog"
      uses: heinrichreimer/github-changelog-generator-action@v2.3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        headerLabel: "# 📑 Changelog"
        breakingLabel: '### 💥 Breaking'
        enhancementLabel: '### 🚀 Enhancements'
        bugsLabel: '### 🐛 Bug fixes'
        deprecatedLabel: '### ⚠️ Deprecations'
        removedLabel: '### 🔥 Removals'
        securityLabel: '### 🛡️ Security'
        issuesLabel: '### 📁 Other issues'
        prLabel: '### 📁 Other pull requests'
        addSections: '{"documentation":{"prefix":"### 📖 Documentation","labels":["documentation"]},"tests":{"prefix":"### ✅ Testing","labels":["tests"]}}'
        issues: true
        issuesWoLabels: true
        pullRequests: true
        prWoLabels: true
        author: true
        unreleased: true
        compareLink: true
        stripGeneratorNotice: true
        verbose: true
    - name: "🖨️ Print changelog to console"
      run: cat CHANGELOG.md
    - name: "📤 Commit files"
      run: |
        git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git commit -am "Update Changelog"
        git push
  release:
    - name: "✏️ Generate release changelog"
      id: generate-release-changelog
      uses: heinrichreimer/github-changelog-generator-action@v2.3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        onlyLastTag: "true"
        stripHeaders: "true"
        stripGeneratorNotice: "true"
    - name: "🚀 Create GitHub release"
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ github.ref }}
        release_name: Release ${{ github.ref }}
        body: ${{ steps.generate-release-changelog.outputs.changelog }}
